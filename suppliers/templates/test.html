{% extends 'base.html' %}

{%block head%} 

<link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">   
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<link rel="stylesheet" href="http://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css"></style>
<script type="text/javascript" src="http://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

<script  src="{{url_for('.static', filename='table.js') }}"></script>


{%endblock%}


{%block content%}

<table id="example" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%"

>
   
   <thead>
       <tr>
        <th>Транзит ID</th>
        <th>Транзитер</th>
       <th>Платежка</th>
       <th>Статус Транзита</th>
       <th>Сумма Транзита</th>
       <th>Перевозчик</th>
       <th>Дата</th>
       
       <tfoot>
            <tr>
                <th> SUM selected:</th>
                <th class='sum'>  </th>
                <th colspan="2" style="text-align:right">Total:</th>
                <th></th>
            </tr>
        </tfoot>
    
    
       
   </thead>
   <tbody>
       {%for i in r%}
       
       <tr>
           <td>{{i.id}}</td>
           <td>{{i.transit.name}}</td>
           {%if i.doc_path%}
           <td><a href="{{url_for('supp.download_tr_doc_pay', filename=i.doc_path )}}">{{i.doc_path}}</a></td>
           {%else%}
           <td></td> 
           {%endif%}
           <td>{{i.status}}</td>
           <td class='sum'>₽{{i.sum}}</td>
           {%if i.payment.supplier%}
           <td>{{i.payment.supplier.llc_name}}</td>
           {%else%}
           <td></td>
           {%endif%}
           <td>{{i.transit_date_send}}</td>
           
        </tr>

        
       {%endfor%}

   </tbody>
   
  </table>


 


{%endblock%}

{%block scripts%}

<script>


$(document).ready(function() {
    var sum = 0;
    var test;
    $('#example').dataTable( {
        "footerCallback": function ( row, data, start, end, display ) {
            var api = this.api(), data;
 
            // Remove the formatting to get integer data for summation
            var intVal = function ( i ) {
                return typeof i === 'string' ?
                    i.replace(/[\₽,]/g, '')*1 :
                    typeof i === 'number' ?
                        i : 0;
            };
 
            // Total over all pages
            total = api
                .column( 4 )
                .data()
                .reduce( function (a, b) {
                    return intVal(a) + intVal(b);
                    test = intVal(a) + intVal(b);
                    
                } );
 
            // Total over this page
            pageTotal = api
                .column( 4, { page: 'current'} )
                .data()
                .reduce( function (a, b) {
                    return intVal(a) + intVal(b);
                }, 0 );
 
            // Update footer
            $( api.column( 4 ).footer() ).html(
                '₽'+pageTotal +' ( ₽'+ total +' total)'
            );
        }
    } );

  
} );
</script>


{%endblock%}


