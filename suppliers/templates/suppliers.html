 {%extends 'base.html'%} {%block head%} {{super()}}
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.2.4.js">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" /> {%endblock%} 


<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />

{%block content%}


<div id="successAlert" class="alert alert-success" role="alert" style="display:none;"></div>
<div id="errorAlert" class="alert alert-danger" role="alert" style="display:none;"></div>
<div class>
    <script src="{{url_for('.static', filename='supp.js')}}"></script>
    <script src="{{url_for('.static', filename='add.js')}}"></script>

    

        <div id="successAlert" class="alert alert-success" role="alert" style="display:none;">

        </div>
        <div id="errorAlert" class="alert alert-danger" role="alert" style="display:none;">


        </div> 
        

        <table class="table table-sm">
        <thead>
            <tr>
                <th>Поиск по имени</th>
                <th>Поиск по ИНН</th>
                
            </tr>
        </thead>
        <tbody>
            <th>
                    <form action=""  method="POST">
                            {{ formName.csrf_token }}
                            {{formName.name.label()}}  {{formName.name}}
                            <input type="submit">
                    </form>
            
            </th>
            <th>
                    <form action=""  method="POST">
                            {{ formINN.csrf_token }}
                            {{formINN.check_inn.label()}}  {{formINN.check_inn}}
                            <input type="submit">
                    </form>

            </th>
        </tbody>
        </table>
       
        

        <div id='content'>

           

        <table class="table table-sm">
            
             <thead>
               
                <tr>
            
                
                <th>id</th>
                <th>Наименование поставщика</th>
                <th>ИНН</th>
                <th>Номера перевозок</th>
                <th>Количество перевозок</th>
                
                <th>Ссылки на Счета</th>
                <th>На какое юр лицо</th>
                <th>Номера счетов</th>
                <th>Сумма счета</th>

              
          
    
            </tr>

            <tbody>
                <th>{{supp.id}}</th>
                <th>{{supp.llc_name}}</th>
                <th>{{supp.inn}}</th>
                <th>{%for i in supp.prefin%}<p>{{i.id}}</p>{%endfor%}</th>
                {%if supp%}
                <th>{{supp.prefin.all()|length}}</th>
                <th>
                    {%for inv in supp.prefin%}

                        {%for invoice in supp.inv %}
                            {%if inv.invs.all()|length > 0%}
                          
                            <p><a href="{{url_for('supp.download_s_inv', filename=invoice.path)}}">{{invoice.path}}</a></p>
                            {%else%}
                            <p>None</p>
                            {%endif%}
                            
                    
                        {%endfor%}
                    {%endfor%}

                </th>
            <th>
                {%for inv in supp.prefin%}
                <p>{{inv.tora_red}}</p>
                {%endfor%}
            </th>
                <th>
                    {%for inv in supp.invoices_list()%}
                    
                 <p>{{inv}}     </p>           
                     {%endfor%}
                    
                </th>

                <th>
                    {%for inv in supp.invoice_amount_list()%}
                    <p>{{inv}}</p>
                    {%endfor%}
                </th>
                {%endif%}

            </tbody>
            
      {%if supp%}

 

    <table class="table table-sm">

            

        <thead>
            <tr>
                
                <th>Действие</th>
                <th>номера счета</th>
                <th>сумма оплаты</th>
                <th>через кого платим(Транзит)</th>
                <th>дата платежа</th>
            </tr>
        </thead>
        <tbody>
            
            <th>
               <button id="write">Записать</button>
            </th>
            
            <form action="">
            <th name='inv_number' id='number'>{{formInv.supp_all_invoices}}</th>
            <th bgcolor="green">{{formInv.summ_pay}}</th>
            <th bgcolor="red">{{formInv.transit}}</th>
            <th bgcolor="yellow">{{formInv.date_payment}}</th>
            </form>
           
        </tbody>

        

    </table>
    {%endif%}
            
    
    </div>
    <div id="successAlert" class="alert alert-success" role="alert" style="display:none;"></div>
    <div id="errorAlert" class="alert alert-danger" role="alert" style="display:none;"></div>
    <script>
      

        $('#write').bind('click', function(e) {
        
        e.preventDefault();

        $.getJSON('/suppliers/suppliers_payments_to_db',{
            summ_amount:$('#summ_pay').val(),
            supp_payment_id:$("#supp_all_invoices").val(),
            transit:$("#transit").val(),
            day:$("#date_payment").val(),
            type:'POST',
            data: '/suppliers/suppliers_payments_to_db',
        }, function(data){
            console.log(data.error)
            
            if(data.error){
                $('#errorAlert').text(data.error).show();
                $('#successAlert').hide();
            }else{
                $('#errorAlert').hide();
                $('#successAlert').text(data.success).show();
                window.setTimeout(function() { location.reload() }, 2000)
            }
            
           
            
        }
        
        )
        });
   
    </script>

    <div >
        <table class="table table-sm">
            <thead>
                <tr>
                    <th>Сумма</th>
                    <th>Дата оплаты</th>
                </tr>
            </thead>
            <tbody>
                <th></th>
                <th id="amount"></th>
            </tbody>
        </table>
    </div>

    <div id="div1" class='z'>
            <p id="p1">This is a paragraph.</p>
            <p id="p2">This is another paragraph.</p>
    </div>

   
    <script>
 
            let number = $('#number');
            let amount = $('#s_inv_amount');
            let a = document.getElementById('amount');
       
            number.on('select2:select', function (e) {
            var number = e.params.data;
            myFunction();
            
            var arr = [];
            console.log('arr 1: ' + arr)
           
     
            fetch('/suppliers/s_inv_number/'+ number.text).then(function(response){
                response.json().then(function(data){
                    console.table(data);
                   
     
                    var newDiv = document.createElement("div");
                            newDiv.id = "div1"
     
                    for (let inv of data.invoices){
                       
                        console.log('eto number:' + number.text)
                        arr.push(inv.s_inv_amount)
     
                        
     
     
                        
                        console.log('arr2 :'  + arr)
                        // a.textContent=inv.s_inv_amount; 
                        arr.forEach(function(item){
     
                        var para = document.createElement("p");
                        var node = document.createTextNode(inv.s_inv_amount);
                        para.appendChild(node);
     
     
                        var element = document.getElementById("div1");
                        element.appendChild(para); 
                        console.log('eto elemetn: ' + item) 
                    })
                    
                }
              })
            
            })
     
        
        })
     
            
        
     
        </script>
    
    
    
      
       
<!-- versio1 -->
       
      

            {%endblock%} {%block scripts%} 
            
            
            {%endblock%}