 {%extends 'base.html'%} {%block head%} {{super()}}
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.2.4.js">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" /> {%endblock%} 


<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />

{%block content%}


<div id="successAlert" class="alert alert-success" role="alert" style="display:none;"></div>
<div id="errorAlert" class="alert alert-danger" role="alert" style="display:none;"></div>
<div class>
    <script src="{{url_for('.static', filename='supp.js')}}"></script>
    <script src="{{url_for('.static', filename='add.js')}}"></script>

    

        <div id="successAlert" class="alert alert-success" role="alert" style="display:none;">

        </div>
        <div id="errorAlert" class="alert alert-danger" role="alert" style="display:none;">


        </div> 
        

        <table class="table table-sm">
        <thead>
            <tr>
                <th>Поиск по имени</th>
                <th>Поиск по ИНН</th>
                
            </tr>
        </thead>
        <tbody>
            <th>
                    <form action=""  method="POST">
                            {{ formName.csrf_token }}
                            {{formName.name.label()}}  {{formName.name}}
                            <input type="submit">
                    </form>
            
            </th>
            <th>
                    <form action=""  method="POST">
                            {{ formINN.csrf_token }}
                            {{formINN.check_inn.label()}}  {{formINN.check_inn}}
                            <input type="submit">
                    </form>

            </th>
        </tbody>
        </table>
       
        

        <div id='content'>

           

        <table class="table table-sm">
            
             <thead>
               
                <tr>
            
                
                <th>id</th>
                <th>Наименование поставщика</th>
                <th>ИНН</th>
                <th>Номера перевозок</th>
                <th>Количество перевозок</th>
                
                <th>Ссылки на Счета</th>
                <th>Номера счетов</th>
                <th>Сумма счета</th>

              
          
    
            </tr>

            <tbody>
                <th>{{supp.id}}</th>
                <th>{{supp.llc_name}}</th>
                <th>{{supp.inn}}</th>
                <th>{%for i in supp.prefin%}<p>{{i.id}}</p>{%endfor%}</th>
                {%if supp%}
                <th>{{supp.prefin.all()|length}}</th>
                <th>
                    {%for inv in supp.prefin%}

                        {%for invoice in supp.inv %}
                            {%if inv.invs.all()|length > 0%}
                          
                            <p><a href="{{url_for('supp.download_s_inv', filename=invoice.path)}}">{{invoice.path}}</a></p>
                            {%else%}
                            <p>None</p>
                            {%endif%}
                            
                    
                        {%endfor%}
                    {%endfor%}

                </th>
                <th>
                    {%for inv in supp.invoices_list()%}
                    
                 <p>{{inv}}     </p>           
                     {%endfor%}
                    
                </th>

                <th>
                    {%for inv in supp.invoice_amount_list()%}
                    <p>{{inv}}</p>
                    {%endfor%}
                </th>
                {%endif%}

            </tbody>
      {%if supp%}
    <table class="table table-sm">
        <thead>
            <tr>
                <th>Действие</th>
                <th>номера счета</th>
                <th>сумма оплаты</th>
                <th>через кого платим(Транзит)</th>
                <th>дата платежа</th>
            </tr>
        </thead>
        <tbody>
            
            <th>
               <button id="write">Записать</button>
            </th>
            
            <form action="">
            <th name='inv_number'>{{formInv.supp_all_invoices}}</th>
            <th>{{formInv.summ_pay}}</th>
            <th>{{formInv.transit}}</th>
            <th>{{formInv.date_payment}}</th>
            </form>
           
        </tbody>


    </table>
    {%endif%}
            
    
    </div>
    <script>
        ///доделать
        // const b = document.getElementById("write")
        // b.addEventListener('click', myFunc)
        // function myFunc(){
        //     alert('workd')

        // }

        $('#write').bind('click', function(e) {
        alert('ready')
        e.preventDefault();

        $.getJSON('/suppliers/suppliers_payments_to_db',{
            summ_amount:$('#summ_pay').val(),
            supp_payment_id:$("#supp_all_invoices").val(),
            type:'POST',
            data: '/suppliers/suppliers_payments_to_db',
        }, function(data){
            console.log(data)
        }
        
        )
        });
   
    </script>
    
    <script>
        

        let number = $('#number');
        let amount = $('#s_inv_amount');
        let a = document.getElementById('amount');

    
        number.on('select2:select', function (e) {
        var number = e.params.data;
        console.log(number.text);

        fetch('/suppliers/s_inv_number/'+ number.text).then(function(response){
            response.json().then(function(data){
                console.table(data);
                let optionHTML='';
                for (let inv of data.invoices){
                    // optionHTML += '<option value="' + inv.id + '">' + inv.s_inv_number + '</option>';
                    console.log(inv.s_inv_amount) 
                    a.textContent=inv.s_inv_amount;   
                }
                
            })
          })

        })






    
     
   
        
        
        

    
   

    </script>
            
            
      
       
<!-- versio1 -->
       
      

            {%endblock%} {%block scripts%} 
            
            
            {%endblock%}